import{u as q,q as H,r as c,x as G,a as d,b as t,d as b,t as n,m as s,f as N,E as O,k as D,v as F,F as I,g as T,n as P,y as L,D as J,o as u}from"./4Al0cLfe.js";const K={class:"min-h-screen bg-gray-50"},Q={class:"bg-white shadow-sm border-b"},W={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},X={class:"py-6"},Y={class:"flex items-center justify-between"},Z={class:"flex items-center space-x-4"},tt={class:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800"},et={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},st={class:"bg-white rounded-lg shadow-sm p-6 mb-6"},ot={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},at={class:"flex items-end"},nt=["disabled"],lt={class:"bg-white rounded-lg shadow-sm overflow-hidden"},rt={class:"overflow-x-auto"},it={class:"min-w-full divide-y divide-gray-200"},dt={class:"bg-white divide-y divide-gray-200"},ut={key:0},pt={key:1},ct={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},mt={class:"px-6 py-4 whitespace-nowrap"},xt={class:"text-sm font-medium text-gray-900"},gt={class:"text-sm text-gray-500"},yt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},ft={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},vt={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},bt={class:"px-6 py-4 whitespace-nowrap"},ht={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},wt={class:"flex space-x-2"},_t=["onClick"],kt=["onClick"],Ct={class:"bg-gray-50 px-6 py-3 flex items-center justify-between"},St={class:"text-sm text-gray-700"},Nt={class:"flex space-x-2"},$t=["disabled"],At=["disabled"],Pt={class:"p-6"},jt={class:"flex justify-between items-center mb-6"},Et={class:"text-xl font-semibold text-gray-900"},Ut={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},Ot={class:"space-y-4"},Dt={class:"bg-gray-50 p-4 rounded-lg space-y-2"},Ft={class:"flex justify-between"},It={class:"text-gray-900"},Tt={class:"flex justify-between"},Lt={class:"text-gray-900"},Vt={key:0,class:"flex justify-between"},Mt={class:"text-gray-900"},zt={class:"bg-gray-50 p-4 rounded-lg space-y-2"},Bt={class:"flex justify-between"},Rt={class:"text-gray-900"},qt={class:"flex justify-between"},Ht={class:"flex justify-between"},Gt={class:"text-gray-900"},Jt={key:0,class:"flex justify-between"},Kt={class:"text-gray-900 font-mono"},Qt={class:"bg-gray-50 p-4 rounded-lg"},Wt={class:"space-y-3"},Xt={class:"flex-1"},Yt={class:"font-medium text-gray-900"},Zt={key:0,class:"text-sm text-gray-500"},te={class:"text-sm text-gray-600"},ee={class:"text-sm text-gray-600"},se={class:"text-right"},oe={class:"font-semibold text-gray-900"},ae={class:"border-t mt-4 pt-4"},ne={class:"flex justify-between items-center"},le={class:"text-lg font-bold text-gray-900"},re={key:0,class:"mb-6"},ie={class:"bg-gray-50 p-4 rounded-lg"},de={class:"text-gray-900 whitespace-pre-line"},ue={class:"flex justify-end mt-6 pt-6 border-t"},pe={class:"p-6"},ce={class:"flex justify-between items-center mb-4"},me={class:"space-y-4"},xe=["value"],ge=["value"],ye={class:"flex justify-end space-x-3 mt-6"},fe=["disabled"],he={__name:"orders",setup(ve){q({title:"Orders - Admin - Long ChÃ¢u"});const w=H(),_=c([]),h=c(0),y=c(1),k=c(20),r=c(null),f=c(!1),v=c(!1),m=c(null),x=c(""),C=c(!1),p=c({status:"",dateFrom:"",dateTo:""}),S=async()=>{f.value=!0;try{if(!w.token)throw new Error("No authentication token");const l=new URLSearchParams({page:y.value.toString(),limit:k.value.toString()});p.value.status&&l.append("status",p.value.status.toUpperCase()),p.value.dateFrom&&l.append("dateFrom",p.value.dateFrom),p.value.dateTo&&l.append("dateTo",p.value.dateTo);const e=await $fetch(`/api/admin/orders?${l.toString()}`,{headers:{Authorization:`Bearer ${w.token}`}});console.log("API Response:",e),console.log("API Response:",e),e.success&&(console.log("Orders data:",e.orders),_.value=e.orders.map(o=>({id:o.id,customerName:`${o.user.firstName} ${o.user.lastName}`,customerEmail:o.user.email,customerPhone:o.user.phone||"",createdAt:new Date(o.createdAt),itemCount:o.orderItems.length,total:parseFloat(o.totalAmount||"0"),status:o.status.toLowerCase(),items:o.orderItems.map(i=>({id:i.id,name:i.product.name,quantity:i.quantity,price:parseFloat(i.price||"0"),manufacturer:i.product.manufacturer})),shippingAddress:(()=>{try{return o.shippingAddress?typeof o.shippingAddress=="string"?JSON.parse(o.shippingAddress):o.shippingAddress:null}catch(i){return console.error("Error parsing shipping address for order",o.id,i),null}})(),trackingNumber:o.trackingNumber})),h.value=e.pagination.totalCount,console.log("Transformed orders:",_.value))}catch(l){console.error("Error loading orders:",l),alert("Failed to load orders. Please try again.")}finally{f.value=!1}},j=l=>new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),V=l=>{var e;if(!l)return"No shipping address provided";try{const o=typeof l=="string"?JSON.parse(l):l;let i="";(o.firstName||o.lastName)&&(i+=`${o.firstName||""} ${o.lastName||""}`.trim()+`
`),o.address&&(i+=o.address+`
`);let g="";return o.city&&(g+=o.city),o.state&&(g+=(g?", ":"")+o.state),o.zipCode&&(g+=(g?" ":"")+o.zipCode),g&&(i+=g+`
`),o.country&&(i+={US:"United States",VN:"Vietnam",CA:"Canada",UK:"United Kingdom"}[o.country]||o.country),o.phone&&o.phone!==((e=r.value)==null?void 0:e.customerPhone)&&(i+=`

Delivery Phone: `+o.phone),o.specialInstructions&&(i+=`

Special Instructions: `+o.specialInstructions),i.trim()}catch(o){return console.error("Error formatting shipping address:",o),"Error displaying shipping address"}},$=l=>({pending:"bg-yellow-100 text-yellow-800",processing:"bg-blue-100 text-blue-800",shipped:"bg-purple-100 text-purple-800",delivered:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"})[l]||"bg-gray-100 text-gray-800",M=l=>{r.value=l},z=async l=>{m.value=l,x.value=l.status,v.value=!0},B=async()=>{if(!x.value||x.value===m.value.status){v.value=!1;return}C.value=!0;try{if(!w.token)throw new Error("No authentication token");if((await $fetch(`/api/admin/orders/${m.value.id}`,{method:"PATCH",headers:{Authorization:`Bearer ${w.token}`,"Content-Type":"application/json"},body:{status:x.value.toUpperCase()}})).success)m.value.status=x.value.toLowerCase(),alert(`Order #${m.value.id} status updated to ${x.value}`),v.value=!1;else throw new Error("Failed to update order status")}catch(l){console.error("Error updating order status:",l),alert("Failed to update order status. Please try again.")}finally{C.value=!1}};return G(()=>{S()}),(l,e)=>{var o,i,g,A,E,U;return u(),d("div",K,[t("div",Q,[t("div",W,[t("div",X,[t("div",Y,[e[14]||(e[14]=t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900"},"Order Management"),t("p",{class:"mt-1 text-sm text-gray-500"},"View and manage all customer orders")],-1)),t("div",Z,[t("span",tt,n(s(h))+" Total Orders ",1)])])])])]),t("div",et,[t("div",st,[t("div",ot,[t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Status",-1)),N(t("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>s(p).status=a),class:"w-full border border-gray-300 rounded-md px-3 py-2"},e[15]||(e[15]=[D('<option value="">All Status</option><option value="pending">Pending</option><option value="processing">Processing</option><option value="shipped">Shipped</option><option value="delivered">Delivered</option><option value="cancelled">Cancelled</option>',6)]),512),[[O,s(p).status]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Date Range",-1)),N(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>s(p).dateFrom=a),type:"date",class:"w-full border border-gray-300 rounded-md px-3 py-2"},null,512),[[F,s(p).dateFrom]])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"To",-1)),N(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>s(p).dateTo=a),type:"date",class:"w-full border border-gray-300 rounded-md px-3 py-2"},null,512),[[F,s(p).dateTo]])]),t("div",at,[t("button",{onClick:S,disabled:s(f),class:"w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 disabled:opacity-50"},n(s(f)?"Loading...":"Apply Filters"),9,nt)])])]),t("div",lt,[t("div",rt,[t("table",it,[e[21]||(e[21]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Order ID "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Customer "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Date "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Items "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Total "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Status "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),t("tbody",dt,[s(f)?(u(),d("tr",ut,e[19]||(e[19]=[t("td",{colspan:"7",class:"px-6 py-8 text-center text-gray-500"},[t("div",{class:"flex items-center justify-center space-x-2"},[t("svg",{class:"animate-spin h-5 w-5 text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),t("span",null,"Loading orders...")])],-1)]))):s(_).length===0?(u(),d("tr",pt,e[20]||(e[20]=[t("td",{colspan:"7",class:"px-6 py-8 text-center text-gray-500"}," No orders found. Try adjusting your filters. ",-1)]))):(u(!0),d(I,{key:2},T(s(_),a=>(u(),d("tr",{key:a.id,class:"hover:bg-gray-50"},[t("td",ct," #"+n(a.id),1),t("td",mt,[t("div",xt,n(a.customerName),1),t("div",gt,n(a.customerEmail),1)]),t("td",yt,n(j(a.createdAt)),1),t("td",ft,n(a.itemCount)+" items ",1),t("td",vt," $"+n(a.total.toFixed(2)),1),t("td",bt,[t("span",{class:P([$(a.status),"inline-flex px-2 py-1 text-xs font-semibold rounded-full"])},n(a.status),3)]),t("td",ht,[t("div",wt,[t("button",{onClick:R=>M(a),class:"text-blue-600 hover:text-blue-900"}," View ",8,_t),t("button",{onClick:R=>z(a),class:"text-green-600 hover:text-green-900"}," Update ",8,kt)])])]))),128))])])]),t("div",Ct,[t("div",St," Showing "+n((s(y)-1)*s(k)+1)+" to "+n(Math.min(s(y)*s(k),s(h)))+" of "+n(s(h))+" orders ",1),t("div",Nt,[t("button",{onClick:e[3]||(e[3]=a=>{y.value--,S()}),disabled:s(y)===1||s(f),class:"px-3 py-1 border border-gray-300 rounded-md text-sm disabled:opacity-50"}," Previous ",8,$t),t("button",{onClick:e[4]||(e[4]=a=>{y.value++,S()}),disabled:s(y)*s(k)>=s(h)||s(f),class:"px-3 py-1 border border-gray-300 rounded-md text-sm disabled:opacity-50"}," Next ",8,At)])])])]),s(r)?(u(),d("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:e[8]||(e[8]=a=>r.value=null)},[t("div",{class:"bg-white rounded-lg max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",onClick:e[7]||(e[7]=L(()=>{},["stop"]))},[t("div",Pt,[t("div",jt,[t("h3",Et,"Order #"+n(s(r).id),1),t("button",{onClick:e[5]||(e[5]=a=>r.value=null),class:"text-gray-400 hover:text-gray-600"},e[22]||(e[22]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),t("div",Ut,[t("div",Ot,[t("div",null,[e[26]||(e[26]=t("h4",{class:"text-lg font-medium text-gray-900 mb-3"},"Customer Information",-1)),t("div",Dt,[t("div",Ft,[e[23]||(e[23]=t("span",{class:"font-medium text-gray-700"},"Name:",-1)),t("span",It,n(s(r).customerName),1)]),t("div",Tt,[e[24]||(e[24]=t("span",{class:"font-medium text-gray-700"},"Email:",-1)),t("span",Lt,n(s(r).customerEmail),1)]),s(r).customerPhone?(u(),d("div",Vt,[e[25]||(e[25]=t("span",{class:"font-medium text-gray-700"},"Phone:",-1)),t("span",Mt,n(s(r).customerPhone),1)])):b("",!0)])]),t("div",null,[e[31]||(e[31]=t("h4",{class:"text-lg font-medium text-gray-900 mb-3"},"Order Information",-1)),t("div",zt,[t("div",Bt,[e[27]||(e[27]=t("span",{class:"font-medium text-gray-700"},"Order Date:",-1)),t("span",Rt,n(j(s(r).createdAt)),1)]),t("div",qt,[e[28]||(e[28]=t("span",{class:"font-medium text-gray-700"},"Status:",-1)),t("span",{class:P([$(s(r).status),"inline-flex px-2 py-1 text-xs font-semibold rounded-full"])},n(s(r).status.toUpperCase()),3)]),t("div",Ht,[e[29]||(e[29]=t("span",{class:"font-medium text-gray-700"},"Total Items:",-1)),t("span",Gt,n(s(r).itemCount),1)]),s(r).trackingNumber?(u(),d("div",Jt,[e[30]||(e[30]=t("span",{class:"font-medium text-gray-700"},"Tracking Number:",-1)),t("span",Kt,n(s(r).trackingNumber),1)])):b("",!0)])])]),t("div",null,[e[33]||(e[33]=t("h4",{class:"text-lg font-medium text-gray-900 mb-3"},"Order Items",-1)),t("div",Qt,[t("div",Wt,[(u(!0),d(I,null,T(s(r).items,a=>(u(),d("div",{key:a.id,class:"flex justify-between items-center p-3 bg-white rounded border"},[t("div",Xt,[t("div",Yt,n(a.name),1),a.manufacturer?(u(),d("div",Zt,n(a.manufacturer),1)):b("",!0),t("div",te,"Quantity: "+n(a.quantity),1),t("div",ee,"Unit Price: $"+n(a.price.toFixed(2)),1)]),t("div",se,[t("div",oe,"$"+n((a.price*a.quantity).toFixed(2)),1)])]))),128))]),t("div",ae,[t("div",ne,[e[32]||(e[32]=t("span",{class:"text-lg font-semibold text-gray-900"},"Total:",-1)),t("span",le,"$"+n(s(r).total.toFixed(2)),1)])])])])]),s(r).shippingAddress?(u(),d("div",re,[e[34]||(e[34]=t("h4",{class:"text-lg font-medium text-gray-900 mb-3"},"Shipping Address",-1)),t("div",ie,[t("p",de,n(V(s(r).shippingAddress)),1)])])):b("",!0),t("div",ue,[t("button",{onClick:e[6]||(e[6]=a=>r.value=null),class:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50"}," Close ")])])])])):b("",!0),s(v)?(u(),d("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:e[13]||(e[13]=a=>v.value=!1)},[t("div",{class:"bg-white rounded-lg max-w-md w-full mx-4",onClick:e[12]||(e[12]=L(()=>{},["stop"]))},[t("div",pe,[t("div",ce,[e[36]||(e[36]=t("h3",{class:"text-lg font-medium text-gray-900"},"Update Order Status",-1)),t("button",{onClick:e[9]||(e[9]=a=>v.value=!1),class:"text-gray-400 hover:text-gray-600"},e[35]||(e[35]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),t("div",me,[t("div",null,[e[37]||(e[37]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Order ID",-1)),t("input",{type:"text",value:`#${(o=s(m))==null?void 0:o.id}`,readonly:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 text-gray-500"},null,8,xe)]),t("div",null,[e[38]||(e[38]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Customer",-1)),t("input",{type:"text",value:(i=s(m))==null?void 0:i.customerName,readonly:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 text-gray-500"},null,8,ge)]),t("div",null,[e[39]||(e[39]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Current Status",-1)),t("span",{class:P([$((g=s(m))==null?void 0:g.status),"inline-flex px-3 py-1 text-sm font-semibold rounded-full"])},n((E=(A=s(m))==null?void 0:A.status)==null?void 0:E.toUpperCase()),3)]),t("div",null,[e[41]||(e[41]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"New Status",-1)),N(t("select",{"onUpdate:modelValue":e[10]||(e[10]=a=>J(x)?x.value=a:null),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500"},e[40]||(e[40]=[D('<option value="pending">PENDING</option><option value="processing">PROCESSING</option><option value="shipped">SHIPPED</option><option value="delivered">DELIVERED</option><option value="cancelled">CANCELLED</option>',5)]),512),[[O,s(x)]])])]),t("div",ye,[t("button",{onClick:e[11]||(e[11]=a=>v.value=!1),class:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50"}," Cancel "),t("button",{onClick:B,disabled:s(C)||s(x)===((U=s(m))==null?void 0:U.status),class:"px-4 py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700 disabled:opacity-50"},n(s(C)?"Updating...":"Update Status"),9,fe)])])])])):b("",!0)])}}};export{he as default};
