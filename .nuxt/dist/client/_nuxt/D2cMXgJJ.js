import{u as ee,q as te,c as g,r as x,x as se,J as oe,K as re,j as ne,a,b as t,t as l,h as y,f as L,E as T,k as le,e as D,w as O,d as k,v as ae,F as M,g as j,_ as de,o as d,n as $,H as ie}from"./4Al0cLfe.js";import{u as ue}from"./BC9IWa7q.js";import{u as ce}from"./-W0ciY3d.js";const me={class:"min-h-screen bg-gray-50"},ge={class:"bg-white shadow-sm"},pe={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},ve={class:"py-6"},xe={class:"flex items-center justify-between"},ye={class:"flex items-center space-x-4"},fe={class:"text-sm text-gray-500"},he=["disabled"],be={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},we={key:1,class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},_e={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},ke={class:"grid grid-cols-1 lg:grid-cols-4 gap-8"},Ce={class:"lg:col-span-1"},De={class:"bg-white rounded-lg shadow-sm p-6"},Oe={class:"mb-6"},Se={class:"mb-6"},Ae={class:"border-t border-gray-200 pt-4"},Le={class:"space-y-2 text-sm"},Me={class:"flex justify-between"},je={class:"font-medium"},Fe={class:"flex justify-between"},Ie={class:"font-medium"},Ve={class:"flex justify-between"},Pe={class:"font-medium"},Ne={class:"bg-white rounded-lg shadow-sm p-6 mt-6"},He={class:"space-y-3"},Re={class:"lg:col-span-3"},Be={class:"bg-white rounded-lg shadow-sm p-4 mb-6"},Te={class:"relative"},$e={key:0,class:"text-center py-12"},Ee={key:1,class:"bg-white rounded-lg shadow-sm p-12 text-center"},Ue={key:2,class:"space-y-6"},ze={class:"bg-gray-50 px-6 py-4 border-b border-gray-200"},qe={class:"flex items-center justify-between"},Ye={class:"flex items-center space-x-6"},Qe={class:"text-sm font-medium text-gray-900"},Je={class:"text-sm text-gray-500"},Ke={class:"text-sm font-medium text-gray-900"},Ge={class:"px-6 py-4"},We={class:"space-y-3"},Xe=["src","alt"],Ze={class:"flex-1 min-w-0"},et={class:"text-sm font-medium text-gray-900 truncate"},tt={class:"text-sm text-gray-500"},st={class:"text-sm text-gray-500"},ot={class:"text-sm font-medium text-gray-900"},rt={key:0,class:"text-sm text-gray-500 border-t border-gray-200 pt-3"},nt={class:"flex items-center justify-between mt-4 pt-4 border-t border-gray-200"},lt={class:"flex items-center space-x-4 text-sm"},at={class:"text-gray-500"},dt={key:0,class:"text-gray-500"},it={class:"flex items-center space-x-2"},ut=["onClick"],ct=["onClick"],mt=["onClick"],gt={key:3,class:"bg-white rounded-lg shadow-sm p-4 mt-6"},pt={class:"flex items-center justify-between"},vt={class:"text-sm text-gray-500"},xt={class:"flex items-center space-x-2"},yt=["disabled"],ft={class:"flex items-center space-x-1"},ht=["onClick"],bt=["disabled"],f=10,Dt={__name:"orders",setup(wt){ee({title:"Order History - Long Châu",meta:[{name:"description",content:"View and track your order history, reorder items, and manage returns."}]});const u=ue(),i=ce(),E=te(),C=s=>{const e=s.orderItems||s.items||[];return console.log("getOrderItems called for order:",s.orderNumber,"items:",e),e};g(()=>{const s=E.getUserRole;return console.log("Current user role:",s,"Is admin:",s==="ADMIN"||s==="admin"),s==="ADMIN"||s==="admin"});const p=x(!1),h=x(""),b=x(""),w=x(""),c=x(1),_=x(""),S=g(()=>u.orders||[]),v=g(()=>{let s=S.value;if(h.value){const e=h.value.toLowerCase();s=s.filter(n=>{var o;return((o=n.orderNumber)==null?void 0:o.toLowerCase().includes(e))||C(n).some(m=>{var r;return(((r=m.product)==null?void 0:r.name)||m.name||"").toLowerCase().includes(e)})})}if(b.value&&(s=s.filter(e=>e.status===b.value)),w.value){const e=new Date,n=new Date;switch(w.value){case"last30":n.setDate(e.getDate()-30);break;case"last90":n.setDate(e.getDate()-90);break;case"lastyear":n.setFullYear(e.getFullYear()-1);break}s=s.filter(o=>new Date(o.createdAt)>=n)}return s.sort((e,n)=>new Date(n.createdAt)-new Date(e.createdAt))}),U=g(()=>{const s=(c.value-1)*f,e=s+f;return v.value.slice(s,e)}),F=g(()=>Math.ceil(v.value.length/f)),A=g(()=>S.value.length),I=g(()=>S.value.reduce((s,e)=>s+(e.total||e.totalAmount||0),0)),z=g(()=>A.value>0?I.value/A.value:0),V=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),q=s=>({pending:"bg-yellow-100 text-yellow-800",processing:"bg-blue-100 text-blue-800",shipped:"bg-purple-100 text-purple-800",delivered:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"})[s==null?void 0:s.toLowerCase()]||"bg-gray-100 text-gray-800",Y=async s=>{try{i.info("Downloading invoice..."),i.success("Invoice downloaded successfully")}catch(e){console.error("Error downloading invoice:",e),i.error("Failed to download invoice. Please try again.")}},Q=async()=>{try{if(v.value.length===0){i.warning("No orders to download");return}i.info("Preparing order history..."),i.success("Order history downloaded successfully")}catch(s){console.error("Error downloading order history:",s),i.error("Failed to download order history. Please try again.")}},J=async()=>{p.value=!0;try{console.log("Manual refresh: Loading orders..."),await u.fetchOrders(),console.log("Manual refresh: Orders loaded:",u.orders.length),_.value=new Date().toLocaleTimeString(),i.success("Orders refreshed successfully")}catch(s){console.error("Error refreshing orders:",s),i.error("Failed to refresh orders. Please try again.")}finally{p.value=!1}},K=s=>{var n;return["delivered","completed"].includes((n=s.status)==null?void 0:n.toLowerCase())},G=async s=>{try{i.info("Adding items to cart..."),await u.reorderItems(s.id),i.success("Items added to cart successfully!")}catch(e){console.error("Error reordering items:",e),i.error("Failed to reorder items. Please try again.")}},W=s=>{var r;if(!["delivered","completed"].includes((r=s.status)==null?void 0:r.toLowerCase()))return!1;const n=new Date(s.createdAt);return Math.floor((new Date-n)/(1e3*60*60*24))<=30},X=s=>{ie(`/returns/initiate?orderId=${s.id}`)},Z=g(()=>{const s=[],e=F.value,n=c.value;if(e<=7)for(let o=1;o<=e;o++)s.push(o);else{const o=Math.max(1,n-2),m=Math.min(e,n+2);for(let r=o;r<=m;r++)s.push(r);o>1&&(s.unshift(1),o>2&&s.splice(1,0,"...")),m<e&&(m<e-1&&s.push("..."),s.push(e))}return s});return se(async()=>{p.value=!0;try{console.log("Orders page: Loading orders..."),await u.fetchOrders(),console.log("Orders page: Orders loaded:",u.orders.length),_.value=new Date().toLocaleTimeString(),u.orders.length>0&&(console.log("First order structure:",u.orders[0]),console.log("First order items property:",u.orders[0].items||u.orders[0].orderItems))}catch(e){console.error("Error loading orders:",e),i.error("Failed to load orders")}finally{p.value=!1}const s=oe(async()=>{try{console.log("Auto-refresh: Checking for order updates..."),await u.fetchOrders(),_.value=new Date().toLocaleTimeString(),console.log("Auto-refresh completed at:",_.value)}catch(e){console.error("Auto-refresh error:",e)}},3e4);re(()=>{s&&clearInterval(s)})}),ne([h,b,w],()=>{c.value=1}),(s,e)=>{const n=de;return d(),a("div",me,[t("div",ge,[t("div",pe,[t("div",ve,[t("div",xe,[e[8]||(e[8]=t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900"},"Order History"),t("p",{class:"mt-1 text-sm text-gray-500"},"View and track your orders")],-1)),t("div",ye,[t("div",fe," Last updated: "+l(_.value),1),t("button",{onClick:Q,class:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50"},e[5]||(e[5]=[t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),y(" Download History ")])),t("button",{onClick:J,disabled:p.value,class:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"},[p.value?(d(),a("svg",be,e[6]||(e[6]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(d(),a("svg",we,e[7]||(e[7]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)]))),y(" "+l(p.value?"Refreshing...":"Refresh Orders"),1)],8,he)])])])])]),t("div",_e,[t("div",ke,[t("div",Ce,[t("div",De,[e[17]||(e[17]=t("h3",{class:"font-semibold text-gray-900 mb-4"},"Filter Orders",-1)),t("div",Oe,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Order Status",-1)),L(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>b.value=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm"},e[9]||(e[9]=[le('<option value="">All Orders</option><option value="pending">Pending</option><option value="processing">Processing</option><option value="shipped">Shipped</option><option value="delivered">Delivered</option><option value="cancelled">Cancelled</option>',6)]),512),[[T,b.value]])]),t("div",Se,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Date Range",-1)),L(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>w.value=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm"},e[11]||(e[11]=[t("option",{value:""},"All Time",-1),t("option",{value:"last30"},"Last 30 Days",-1),t("option",{value:"last90"},"Last 90 Days",-1),t("option",{value:"lastyear"},"Last Year",-1)]),512),[[T,w.value]])]),t("div",Ae,[e[16]||(e[16]=t("h4",{class:"font-medium text-gray-900 mb-3"},"Order Summary",-1)),t("div",Le,[t("div",Me,[e[13]||(e[13]=t("span",{class:"text-gray-500"},"Total Orders:",-1)),t("span",je,l(A.value),1)]),t("div",Fe,[e[14]||(e[14]=t("span",{class:"text-gray-500"},"Total Spent:",-1)),t("span",Ie,"$"+l((I.value||0).toFixed(2)),1)]),t("div",Ve,[e[15]||(e[15]=t("span",{class:"text-gray-500"},"Avg. Order:",-1)),t("span",Pe,"$"+l((z.value||0).toFixed(2)),1)])])])]),t("div",Ne,[e[21]||(e[21]=t("h3",{class:"font-semibold text-gray-900 mb-4"},"Quick Actions",-1)),t("div",He,[D(n,{to:"/track-order",class:"w-full inline-flex items-center justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50"},{default:O(()=>e[18]||(e[18]=[t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})],-1),y(" Track Order ")])),_:1,__:[18]}),D(n,{to:"/return-policy",class:"w-full inline-flex items-center justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50"},{default:O(()=>e[19]||(e[19]=[t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),y(" Return Policy ")])),_:1,__:[19]}),D(n,{to:"/contact",class:"w-full inline-flex items-center justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50"},{default:O(()=>e[20]||(e[20]=[t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})],-1),y(" Support ")])),_:1,__:[20]})])])]),t("div",Re,[t("div",Be,[t("div",Te,[L(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>h.value=o),type:"text",placeholder:"Search orders by order number, product name...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[ae,h.value]]),e[22]||(e[22]=t("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[t("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))])]),p.value?(d(),a("div",$e,e[23]||(e[23]=[t("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),t("p",{class:"mt-2 text-gray-500"},"Loading orders...",-1)]))):v.value.length===0?(d(),a("div",Ee,[e[25]||(e[25]=t("svg",{class:"w-16 h-16 text-gray-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})],-1)),e[26]||(e[26]=t("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No orders found",-1)),e[27]||(e[27]=t("p",{class:"text-gray-500 mb-6"},"You haven't placed any orders matching your filters.",-1)),D(n,{to:"/products",class:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"},{default:O(()=>e[24]||(e[24]=[y(" Start Shopping ")])),_:1,__:[24]})])):(d(),a("div",Ue,[(d(!0),a(M,null,j(U.value,o=>{var m;return d(),a("div",{key:o.id,class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},[t("div",ze,[t("div",qe,[t("div",Ye,[t("div",null,[t("p",Qe,"Order #"+l(o.orderNumber),1),t("p",Je,"Placed "+l(V(o.createdAt)),1)]),t("div",null,[e[28]||(e[28]=t("p",{class:"text-sm text-gray-500"},"Total",-1)),t("p",Ke,"$"+l((o.total||o.totalAmount||0).toFixed(2)),1)]),t("div",null,[e[29]||(e[29]=t("p",{class:"text-sm text-gray-500"},"Status",-1)),t("span",{class:$(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",q(o.status)])},l(o.status),3)])])])]),t("div",Ge,[t("div",We,[(d(!0),a(M,null,j(C(o).slice(0,3),r=>{var P,N,H,R,B;return d(),a("div",{key:r.id||r.name,class:"flex items-center space-x-4"},[t("img",{src:((N=(P=r.product)==null?void 0:P.images)==null?void 0:N[0])||r.image||"/images/default-product.jpg",alt:((H=r.product)==null?void 0:H.name)||r.name||"Product",class:"w-16 h-16 object-cover rounded-lg border border-gray-200"},null,8,Xe),t("div",Ze,[t("h4",et,l(((R=r.product)==null?void 0:R.name)||r.name||"Unknown Product"),1),t("p",tt,l(((B=r.product)==null?void 0:B.manufacturer)||"Unknown Brand"),1),t("p",st,"Qty: "+l(r.quantity),1)]),t("div",ot," $"+l(((r.price||0)*(r.quantity||0)).toFixed(2)),1)])}),128)),C(o).length>3?(d(),a("div",rt," +"+l(C(o).length-3)+" more items ",1)):k("",!0)]),t("div",nt,[t("div",lt,[t("span",at," Delivered to: "+l(((m=o.shippingAddress)==null?void 0:m.name)||"Default Address"),1),o.estimatedDelivery?(d(),a("span",dt," • Est. delivery: "+l(V(o.estimatedDelivery)),1)):k("",!0)]),t("div",it,[K(o)?(d(),a("button",{key:0,onClick:r=>G(o),class:"text-sm text-blue-600 hover:text-blue-500 font-medium"}," Reorder ",8,ut)):k("",!0),W(o)?(d(),a("button",{key:1,onClick:r=>X(o),class:"text-sm text-blue-600 hover:text-blue-500 font-medium"}," Return Items ",8,ct)):k("",!0),t("button",{onClick:r=>Y(),class:"text-sm text-blue-600 hover:text-blue-500 font-medium"}," Invoice ",8,mt)])])])])}),128))])),v.value.length>f?(d(),a("div",gt,[t("div",pt,[t("div",vt," Showing "+l((c.value-1)*f+1)+" to "+l(Math.min(c.value*f,v.value.length))+" of "+l(v.value.length)+" orders ",1),t("div",xt,[t("button",{onClick:e[3]||(e[3]=o=>c.value--),disabled:c.value===1,class:"inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-sm font-medium rounded text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," Previous ",8,yt),t("div",ft,[(d(!0),a(M,null,j(Z.value,o=>(d(),a("button",{key:o,onClick:m=>c.value=o,class:$([o===c.value?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-50","inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-sm font-medium rounded"])},l(o),11,ht))),128))]),t("button",{onClick:e[4]||(e[4]=o=>c.value++),disabled:c.value===F.value,class:"inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-sm font-medium rounded text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," Next ",8,bt)])])])):k("",!0)])])])])}}};export{Dt as default};
